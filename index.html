<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Assistant Message IA - Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body style="font-family: system-ui, sans-serif; margin: 20px;">
    <h1>Assistant Message IA - Test</h1>

    <p>
      <strong>Notes :</strong><br />
      <textarea id="inputText" rows="4" cols="60">
Dire que je suis surpris par le retard et demander un retour avant demain.</textarea
      >
    </p>

    <p>
      <strong>Ton :</strong>
      <select id="tone">
        <option value="professionnel">professionnel</option>
        <option value="amical">amical</option>
        <option value="concis">concis</option>
        <option value="ferme">ferme</option>
      </select>
    </p>

    <p>
      <strong>Signature :</strong><br />
      <textarea id="signature" rows="2" cols="60">
Cordialement,
Mourad Afekhssi</textarea
      >
    </p>

    <button id="generateBtn">G√©n√©rer le mail</button>

    <p><strong>R√©sultat :</strong></p>
    <pre id="output" style="white-space:pre-wrap;border:1px solid #ccc;padding:10px;"></pre>

    <p id="status" style="color:gray;font-size:0.9rem;"></p>

    <script>
      // üëâ URL de TON worker
      const WORKER_URL =
        "https://assistant-message-ia.mourad-afekhssi.workers.dev/";

      console.log("Script charg√©");

      window.addEventListener("DOMContentLoaded", () => {
        console.log("DOM charg√©");

        const inputText = document.getElementById("inputText");
        const tone = document.getElementById("tone");
        const signature = document.getElementById("signature");
        const btn = document.getElementById("generateBtn");
        const output = document.getElementById("output");
        const status = document.getElementById("status");

        console.log("√âl√©ments r√©cup√©r√©s :", {
          inputText,
          tone,
          signature,
          btn,
          output,
        });

        btn.addEventListener("click", async () => {
          console.log("Bouton cliqu√©");
          status.textContent = "Appel au worker...";
          output.textContent = "";

          const body = {
            notes: inputText.value.trim(),
            tone: tone.value,
            signature: signature.value.trim(),
          };

          console.log("Body envoy√© au worker :", body);

          try {
            const res = await fetch(WORKER_URL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(body),
            });

            console.log("R√©ponse brute du worker :", res.status, res.statusText);

            const data = await res.json().catch((e) => {
              console.error("Erreur parse JSON:", e);
              throw e;
            });

            console.log("JSON re√ßu :", data);

            if (!res.ok) {
              status.textContent = "Erreur c√¥t√© worker : " + (data.error || "");
              output.textContent = JSON.stringify(data, null, 2);
              return;
            }

            status.textContent = "OK";
            output.textContent = data.mail || "(pas de mail)";
          } catch (e) {
            console.error("Erreur globale :", e);
            status.textContent = "Erreur JS : " + e.message;
          }
        });
      });
    </script>
  </body>
</html>
